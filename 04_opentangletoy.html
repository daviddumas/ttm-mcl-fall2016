<html>

<head>
    <title>04_opentangletoy</title>
	<a href="index.html">Back to list of visualizations</a>
    <script src= "js/three.js"></script>
    <script src= "js/dat.gui.js"></script>
    <script src= "js/TrackballControls.js"></script>
	

    <style>
        body {
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
	
	
	<label id="display"></label>

	
<!-- Div which will hold the Output -->
<div id="WebGL-output">
</div>

<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">
// Constant matrix that moves a frame from start of a link to the end
var N = new THREE.Matrix4();
N.set( 
    0, -1, 0, 0, 
    1,  0, 0, 0,
    0,  0, 1, 0,
    0, 0, 0, 1);
var N2 = new THREE.Matrix4();
N2.multiplyMatrices(N,N);
var N3 = new THREE.Matrix4();
N3.multiplyMatrices(N2,N);

//Index for the four different colors.
var c = 0;
function newArc(){
    var paletter = new Array(0xff0000, 0x5000ff, 0xffff00, 0x00ff00);
	var material = new THREE.MeshBasicMaterial( { color: paletter[ c % 4 ] } )
	c++;
	
	var geometry = new THREE.TorusGeometry( 1, .30, 100, 10, Math.PI * 0.5);
	var arc = new THREE.Mesh( geometry, material );
    arc.matrixAutoUpdate = false;
    return arc;
	
}

function RotX(theta){
    m = new THREE.Matrix4();
    m.makeRotationX(theta);
    return m;
}

// Link objects; are global so visible in render()
var arc1, arc2, arc3, arc4, arc5, arc6, arc7, arc8;
function init() {    
    // scene, camera, renderer init
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 50;
    var renderer = new THREE.WebGLRenderer();
    renderer.setClearColor(0x000000);
    renderer.setSize(window.innerWidth, window.innerHeight);
    // Trackball camera controls
    var trackballControls = new THREE.TrackballControls(camera, document.getElementById("WebGL-output").appendChild(renderer.domElement) );
    trackballControls.rotateSpeed = 4.0;
    trackballControls.zoomSpeed = 0.05;
    
	// Adapted from website: https://soledadpenades.com/articles/three-js-tutorials/drawing-the-coordinate-axes/.
	/*function buildAxis( src, dst, axisColor, dashed ) {
        var geom = new THREE.Geometry(),
        mat; 

        if(dashed) {
                mat = new THREE.LineDashedMaterial({ linewidth: 3, color: axisColor, dashSize: 3, gapSize: 3 });
        } else {
                mat = new THREE.LineBasicMaterial({ linewidth: 3, color: axisColor });
        }

        geom.vertices.push( src.clone() );
        geom.vertices.push( dst.clone() );
        geom.computeLineDistances(); // This one is SUPER important, otherwise dashed lines will appear as simple plain lines

        var axis = new THREE.Line( geom, mat, THREE.LineSegments );

        return axis;
	}
	function buildAxes( length ) {
        var axes = new THREE.Object3D();

        axes.add( buildAxis( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( length, 0, 0 ), 0xFF0000, true ) ); // +X
        axes.add( buildAxis( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( -length, 0, 0 ), 0xFF0000, true) ); // -X
        axes.add( buildAxis( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, length, 0 ), 0x00FF00, true ) ); // +Y
        axes.add( buildAxis( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, -length, 0 ), 0x00FF00, true ) ); // -Y
        axes.add( buildAxis( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, 0, length ), 0x0000FF, true ) ); // +Z
        axes.add( buildAxis( new THREE.Vector3( 0, 0, 0 ), new THREE.Vector3( 0, 0, -length ), 0x0000FF, true ) ); // -Z
		
		scene.add( axes );
		
        return axes;
	}
	
	buildAxes( 1000 );*/
	
	
    // place canvas in the target div
    document.getElementById("WebGL-output").appendChild(renderer.domElement);
    
    var clock = new THREE.Clock();
    arc1 = newArc();
    scene.add( arc1 ); 
    	
	arc2 = newArc();
    scene.add( arc2 ); 
	
    arc3 = newArc();
    scene.add( arc3 ); 
	
    arc4 = newArc();
    scene.add( arc4 ); 
	
	arc5 = newArc();
    scene.add( arc5 ); 
    arc5.visible = false;
	
	arc6 = newArc();
    scene.add( arc6 ); 
	arc6.visible = false;
	
	arc7 = newArc();
    scene.add( arc7 ); 
    arc7.visible = false;
	
    arc8 = newArc();
    scene.add( arc8 ); 
	arc8.visible = false;
	
	arc9 = newArc();
    scene.add( arc9 ); 
	arc9.visible = false;
	
	arc10 = newArc();
    scene.add( arc10 );
	arc10.visible = false;
	
	arc11 = newArc();
    scene.add( arc11 );
	arc11.visible = false;
	
	arc12 = newArc();
    scene.add( arc12 ); 
	arc12.visible = false;
	
	arc13 = newArc();
    scene.add( arc13 );
	arc13.visible = false;	
	
	arc14 = newArc();
    scene.add( arc14 ); 
	arc14.visible = false;
	
	arc15 = newArc();
    scene.add( arc15 ); 
    arc15.visible = false;
	
	//Array that holds the arcs.
	var arcArray = new Array( arc1, arc2, arc3, arc4, arc5, arc6, arc7, arc8, arc9, arc10, arc11, arc12, arc13, arc14, arc15);
    
    // setup the control gui
    var configuration = {
	T12: 0,
	T23: 0, 
	T34: 0,
	T45: 0,
	T56: 0,
	T67: 0,
	T78: 0,
	T89: 0,
	T910: 0,
	T1011: 0,
	T1112: 0,
	T1213: 0,
	T1314: 0,
	T1415: 0,
	controller: 8,
    };
	
	var  configData = {
  "closed": false,
  "remembered": {
    "Default": {
      "0": {
        "T12": 0,
        "T23": -1.9978749131873716,
        "T34": 0,
        "T45": 0,
        "T56": 1.9978749131873716,
        "T67": -1.9978749131873716,
        "T78": 0,
		"T89": 0,
		"T910": 0,
		"T1011": 0,
		"T1112": 0,
		"T1213": 0,
		"T1314": 0,
		"T1415": 0,
		"controller": 8,        
      }
    },
    "Octagon": {
      "0": {
        "T12": 1.9978749131873716,
        "T23": -1.9978749131873716,
        "T34": 1.9978749131873716,
        "T45": -1.9978749131873716,
        "T56": 1.9978749131873716,
        "T67": -1.9978749131873716,
        "T78": 1.9978749131873716,
		"T89": 0,
		"T910": 0,
		"T1011": 0,
		"T1112": 0,
		"T1213": 0,
		"T1314": 0,
		"T1415": 0,
		"controller": 8,
        
      }
    },
    "Peanut": {
      "0": {
        "T12": 0,
        "T23": 0,
        "T34": 3.14,
        "T45": 3.14,
        "T56": 0,
        "T67": 0,
        "T78": 3.14,
		"T89": 0,
		"T910": 0,
		"T1011": 0,
		"T1112": 0,
		"T1213": 0,
		"T1314": 0,
		"T1415": 0,
		"controller": 8,        
      }
    },
	"S": {
      "0": {
        "T12": 0,
        "T23": 1.570796327,
        "T34": -3.141592654,
        "T45": 1.570796327,
        "T56": 0,
        "T67": -1.570796327,
        "T78": 3.141592654,
		"T89": 0,
		"T910": 0,
		"T1011": 0,
		"T1112": 0,
		"T1213": 0,
		"T1314": 0,
		"T1415": 0,
		"controller": 8,        
      }
    },
    "U": {
      "0": {
        "T12": 0,
        "T23": 1.570796327,
        "T34": 0,
        "T45": -1.570796327,
        "T56": 0,
        "T67": 1.570796327,
        "T78": 0,
		"T89": 0,
		"T910": 0,
		"T1011": 0,
		"T1112": 0,
		"T1213": 0,
		"T1314": 0,
		"T1415": 0,
		"controller": 8,       
      }
    },
	"Eight": {
      "0": {
        "T12": 0,
        "T23": 0,
        "T34": 3.141592654,
        "T45": 0,
        "T56": 0,
        "T67": 0,
        "T78": 3.141592654,
        "T89": 0,
		"T910": 0,
		"T1011": 0,
		"T1112": 0,
		"T1213": 0,
		"T1314": 0,
		"T1415": 0,
		"controller": 8,
      }
    },
	"Pentagon": {
      "0": {
        "T12": 2 * Math.PI / 3 ,
        "T23": Math.atan( Math.sqrt(3) - Math.sqrt(3/2) ),
        "T34": Math.atan( Math.sqrt(3) + Math.sqrt(3/2) ) - Math.PI,
        "T45": 2 * Math.PI / 3 ,
        "T56": -2 * Math.PI / 3 ,
        "T67": Math.PI - Math.atan( Math.sqrt(3) + Math.sqrt(3/2) ),
        "T78": -Math.atan( Math.sqrt(3) - Math.sqrt(3/2) ),
        "T89": 0,
		"T910": 0,
		"T1011": 0,
		"T1112": 0,
		"T1213": 0,
		"T1314": 0,
		"T1415": 0,
		"controller": 8,
      }
    },
	"Square": {
      "0": {
        "T12": 1.1437,
        "T23": 1.1437,
        "T34": -1.1437,
        "T45": -1.1437,
        "T56": 1.1437,
        "T67": 1.1437,
        "T78": -1.1437,
        "T89": 0,
		"T910": 0,
		"T1011": 0,
		"T1112": 0,
		"T1213": 0,
		"T1314": 0,
		"T1415": 0,
		"controller": 8,
      }
    }
  },
  "folders": {}
};
	var gui = new dat.GUI( { load: configData } );	
	gui.remember(configuration);
	
	
	gui.add(configuration, 'T12').min(-Math.PI).max(2 * Math.PI).step(0.1);
    gui.add(configuration, 'T23').min(-Math.PI).max(2 * Math.PI).step(0.1);
	gui.add(configuration, 'T34').min(-Math.PI).max(2 * Math.PI).step(0.1);
	gui.add(configuration, 'T45').min(-Math.PI).max(2 * Math.PI).step(0.1);
	gui.add(configuration, 'T56').min(-Math.PI).max(2 * Math.PI).step(0.1);
	gui.add(configuration, 'T67').min(-Math.PI).max(2 * Math.PI).step(0.1);
	gui.add(configuration, 'T78').min(-Math.PI).max(2 * Math.PI).step(0.1);
	
	var f1 = gui.addFolder('Additional Arc Angles');
	f1.add(configuration, 'T89').min(-Math.PI).max(2 * Math.PI).step(0.1);
	f1.add(configuration, 'T910').min(-Math.PI).max(2 * Math.PI).step(0.1);
	f1.add(configuration, 'T1011').min(-Math.PI).max(2 * Math.PI).step(0.1);
	f1.add(configuration, 'T1112').min(-Math.PI).max(2 * Math.PI).step(0.1);
	f1.add(configuration, 'T1213').min(-Math.PI).max(2 * Math.PI).step(0.1);
	f1.add(configuration, 'T1314').min(-Math.PI).max(2 * Math.PI).step(0.1);
	f1.add(configuration, 'T1415').min(-Math.PI).max(2 * Math.PI).step(0.1);
	gui.add(configuration, 'controller', 0, 15,1);
	

    render();
    
    function render() {
	// Called once per frame
	
        var delta = clock.getDelta();
	trackballControls.update(delta);
	
	//Variables for the translation of the arcs before and after rotation.
	var preTranslation = new THREE.Matrix4();
	
	var postTranslation = new THREE.Matrix4();
			
		
		
	    var m = new THREE.Matrix4();
		
		//Controls which arcs are displayed on the screen.		
		var i;
		for( i = 0; i < 15; i++ )
		{
			if( i < configuration.controller )
			{
				arcArray[i].visible = true;
			}
			else if( i >= configuration.controller )
			{
			 arcArray[i].visible = false;
			}
		
		}
		
		preTranslation.makeTranslation(0,1,0);
		postTranslation.makeTranslation(0,-1,0);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T12));
		m.multiply( postTranslation );
                m.multiply( N );
		
		
        arc2.matrix.copy(m);

		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T23));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc3.matrix.copy(m);

		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T34));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc4.matrix.copy(m);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T45));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc5.matrix.copy(m);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T56));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc6.matrix.copy(m);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T67));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc7.matrix.copy(m);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T78));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc8.matrix.copy(m);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T89));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc9.matrix.copy(m);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T910));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc10.matrix.copy(m);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T1011));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc11.matrix.copy(m);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T1112));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc12.matrix.copy(m);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T1213));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc13.matrix.copy(m);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T1314));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc14.matrix.copy(m);
		
		m.multiply( preTranslation );
		m.multiply(RotX(configuration.T1415));
		m.multiply( postTranslation );
                m.multiply( N );
		
        arc15.matrix.copy(m);
		
        
        // render using requestAnimationFrame
        requestAnimationFrame(render);
        renderer.render(scene, camera);
    }
    
}
	window.onload = init;
</script>
</body>
</html>