<html>

<head>
    <title>03_ArcSimulation</title>
    <script src= "js/three.js"></script>
    <script src= "js/DAT.GUI.js"></script>
    <script src= "js/TrackballControls.js"></script>
	

    <style>
        body {
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>

<!-- Div which will hold the Output -->
<div id="WebGL-output">
</div>

<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">
// once everything is loaded, we run our Three.js stuff.
	
//Create Arcs using matrices
var arc1, arc2, arc3, arc4, arc5;
	
var N = new THREE.Matrix4();

N.set( 
    0, -1, 0, 0, 
    1,  0, 0, 0,
    0,  0, 1, 0,
    0, 0, 0, 1);

// Matrices for the arcs.
var arcMatrix1 = new THREE.Matrix4();	
var arcMatrix2 = new THREE.Matrix4();
var arcMatrix3 = new THREE.Matrix4();
var arcMatrix4 = new THREE.Matrix4();
var arcMatrix5 = new THREE.Matrix4();

// Set initial orientations.
arcMatrix2.copy( N );
arcMatrix3.multiplyMatrices( N, N );
arcMatrix4.multiplyMatrices( arcMatrix3, N );

// Angles of rotation between two arcs.
var theta12, theta23, theta34, theta45, theta14;

//Rotation Matrix.
var R12 = new THREE.Matrix4();

// Elements in a matrix.
var elements;

//Identity matrix
var I = new THREE.Matrix4();

var M = new THREE.Matrix4();
M.set( 
    0, -1, 0, 0, 
    1,  0, 0, 0,
    0,  0, 1, 0,
    0, 0, 0, 1);



function createArc( matrix4 ){
    
    //var elements = matrix4.elements;
    var geometry = new THREE.TorusGeometry( 1, .30, 8, 6, Math.PI * 0.5);
    var material = new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff } );
    
    
    var arc = new THREE.Mesh( geometry, material );
    arc.matrix.copy( matrix4 );
    return arc;
    
}

function rotateOnXAxis( matrix4, angle ){
    
    var preTranslation = new THREE.Matrix4();
    preTranslation.makeTranslation(0,-1,0);
    
    var postTranslation = new THREE.Matrix4();
    postTranslation.makeTranslation(0,1,0);
    
    var rotationX = new THREE.Matrix4();
    rotationX.makeRotationX( angle );
    
    matrix4.premultiply( preTranslation );
    
    matrix4.multiplyMatrices( rotationX, matrix4 );
    matrix4.premultiply( postTranslation );
    
}

function rotateOnYAxis( matrix4, angle ){
    
    var preTranslation = new THREE.Matrix4();
    preTranslation.makeTranslation(-1,0,0);
    
    var postTranslation = new THREE.Matrix4();
    postTranslation.makeTranslation(1,0,0);
    
    var rotationY = new THREE.Matrix4();
    rotationY.makeRotationY( angle );
    
    matrix4.premultiply( preTranslation );
    
    matrix4.multiplyMatrices( rotationY, matrix4 );
    matrix4.premultiply( postTranslation );
    
}

function init() {
    
    // create a scene, that will hold all our elements such as objects, cameras and lights.
    var scene = new THREE.Scene();
    // create a camera, which defines where we're looking at.
    var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 5;
    // create a render and set the size
    var renderer = new THREE.WebGLRenderer();
    renderer.setClearColor(0x000000);
    renderer.setSize(window.innerWidth, window.innerHeight);
    
    // add the output of the renderer to the html element
    document.getElementById("WebGL-output").appendChild(renderer.domElement);
    
    //Sets up the camera to be able to rotate and zoom based on user preference
    var trackballControls = new THREE.TrackballControls(camera);
    trackballControls.rotateSpeed = 4.0;
    trackballControls.zoomSpeed = 0.05;
    
    var clock = new THREE.Clock();
    
    
    
    
    arc1 = createArc( arcMatrix1 );
    scene.add( arc1 ); 
    
    
    
    arc2 = createArc( arcMatrix2 );
    
    
    arc2.matrixAutoUpdate = false;
    
    scene.add( arc2 );
    
    arc3 = createArc( arcMatrix3 );
    
    arc3.matrixAutoUpdate = false;
    
    //scene.add( arc3 );
    
    arc4 = createArc( arcMatrix4 );
    arc4.matrixAutoUpdate = false;
    
    scene.add( arc4 );
    
    
    // setup the control gui
    var controls = new function () {
	// make sure that the parent object has an attribute called "angleOfRotation1".
        this.angleOfRotation1 = .00;
	this.angleOfRotation2 = .00;
        
        
    };
    var gui = new DAT.GUI();
    gui.add(controls, 'angleOfRotation1', 0, Math.PI * 2);
    //				   ^^^^^^^^^^^^^^^ there must be an attribute of this name.
    //								   That's why we create it in "controls".
    gui.add(controls, 'angleOfRotation2', 0, Math.PI * 2);
    
    
    render();
    
    
    function render() {
	
	
        var delta = clock.getDelta();
	trackballControls.update(delta);
	
	//angle of rotation between arc1 and arc2.
        theta12 = controls.angleOfRotation1;
	theta14 = controls.angleOfRotation2;					
	rotateOnXAxis(arc2.matrix, theta12);
	rotateOnYAxis(arc4.matrix, theta14)
	
	
	
        // render using requestAnimationFrame
        requestAnimationFrame(render);
        renderer.render(scene, camera);
    }
    
    
    
    
    
}



window.onload = init;
</script>
</body>
</html>

