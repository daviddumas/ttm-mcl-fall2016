<html>

<head>
    <title>03_ArcSimulation</title>
    <script src= "js/three.js"></script>
    <script src= "js/DAT.GUI.js"></script>
    <script src= "js/TrackballControls.js"></script>
	

    <style>
        body {
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>

<!-- Div which will hold the Output -->
<div id="WebGL-output">
</div>

<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">
// Constant matrix that moves a frame from start of a link to the end
var N = new THREE.Matrix4();
N.set( 
    0, -1, 0, 0, 
    1,  0, 0, 0,
    0,  0, 1, 0,
    0, 0, 0, 1);

var N2 = new THREE.Matrix4();
N2.multiplyMatrices(N,N);

var N3 = new THREE.Matrix4();
N3.multiplyMatrices(N2,N);

function newArc(){
    var geometry = new THREE.TorusGeometry( 1, .30, 12, 10, Math.PI * 0.5);
    var material = new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff } );
    var arc = new THREE.Mesh( geometry, material );
    arc.matrixAutoUpdate = false;
    return arc;
}

function Rot(theta){
    m = new THREE.Matrix4();
    m.makeRotationX(theta);
    return m;
}

// Link objects; are global so visible in render()
var arc1, arc2, arc3, arc4;

function init() {    
    // scene, camera, renderer init
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 5;
    var renderer = new THREE.WebGLRenderer();
    renderer.setClearColor(0x000000);
    renderer.setSize(window.innerWidth, window.innerHeight);

    // Trackball camera controls
    var trackballControls = new THREE.TrackballControls(camera);
    trackballControls.rotateSpeed = 4.0;
    trackballControls.zoomSpeed = 0.05;
    
    // place canvas in the target div
    document.getElementById("WebGL-output").appendChild(renderer.domElement);
    
    var clock = new THREE.Clock();


    arc1 = newArc();
    scene.add( arc1 ); 

    arc2 = newArc();
    arc2.matrix.copy( N );
    scene.add( arc2 ); 

    arc3 = newArc();
    arc3.matrix.copy( N2 );
    scene.add( arc3 ); 

    arc4 = newArc();
    arc4.matrix.copy( N3 );
    scene.add( arc4 ); 
    
    // setup the control gui
    var controls = new function () {
        this.T12 = 0.0;
	this.T23 = 0.0;                
	this.T34 = 0.0;                
    };
    var gui = new DAT.GUI();
    gui.add(controls, 'T12', 0, Math.PI * 2);
    gui.add(controls, 'T23', 0, Math.PI * 2);
    gui.add(controls, 'T34', 0, Math.PI * 2);
        
    render();
    
    function render() {
	// Called once per frame
	
        var delta = clock.getDelta();
	trackballControls.update(delta);
	
	//angle of rotation between arc1 and arc2.
        var m = new THREE.Matrix4();
        m.copy(N);
        m.multiply(Rot(controls.T12));

        arc2.matrix.copy(m);

        m.multiply(N);
        m.multiply(Rot(controls.T23));

        arc3.matrix.copy(m);

        m.multiply(N);
        m.multiply(Rot(controls.T34));

        arc4.matrix.copy(m);
        
        // render using requestAnimationFrame
        requestAnimationFrame(render);
        renderer.render(scene, camera);
    }
    
}

window.onload = init;
</script>
</body>
</html>

